<!-- Slide 3: Agent Sales -->
<div class="page-header">
    <h1 class="page-title">Agent Sales Performance</h1>
    <p class="page-subtitle">Track individual agent sales metrics and conversion rates</p>
    <div class="date-badge">
        <span>{{ start_display }} - {{ end_display }}</span>
    </div>
</div>

{% if agents and agents|length > 0 %}
<!-- Summary Metrics -->
<div class="metrics-grid">
    <div class="metric-card highlight">
        <div class="metric-icon">&#128101;</div>
        <div class="metric-label">Total Agents</div>
        <div class="metric-value">{{ agents|length }}</div>
    </div>

    <div class="metric-card">
        <div class="metric-icon blue">&#128222;</div>
        <div class="metric-label">Total Calls Done</div>
        <div class="metric-value">{{ agents|map(attribute='calls_done')|sum }}</div>
    </div>

    <div class="metric-card">
        <div class="metric-icon green">&#128176;</div>
        <div class="metric-label">Total Purchases</div>
        <div class="metric-value">{{ agents|map(attribute='purchases')|sum }}</div>
    </div>

    <div class="metric-card">
        <div class="metric-icon orange">&#128200;</div>
        <div class="metric-label">Avg High Rating</div>
        <div class="metric-value">{{ (agents|map(attribute='high_rating')|sum / agents|length)|round|int }}%</div>
    </div>

    <div class="metric-card">
        <div class="metric-icon green">&#127942;</div>
        <div class="metric-label">Avg Purchase Rate</div>
        <div class="metric-value">{{ (agents|map(attribute='purchase_rate')|sum / agents|length)|round|int }}%</div>
    </div>
</div>

<!-- Agent Table -->
<div class="card">
    <div class="card-header">
        <span>&#128202;</span> Agent Sales Performance Table
    </div>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Agent Name</th>
                    <th>Calls Done</th>
                    <th>Purchases</th>
                    <th>High Rating %</th>
                    <th>Purchase Rate</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for agent in agents %}
                <tr>
                    <td><strong>{{ agent.agent }}</strong></td>
                    <td>{{ agent.calls_done }}</td>
                    <td>{{ agent.purchases }}</td>
                    <td>{{ agent.high_rating }}%</td>
                    <td>{{ agent.purchase_rate }}%</td>
                    <td>
                        {% if agent.purchase_rate >= 10 %}
                        <span class="badge badge-success">Excellent</span>
                        {% elif agent.purchase_rate >= 5 %}
                        <span class="badge badge-warning">Good</span>
                        {% else %}
                        <span class="badge badge-danger">Needs Improvement</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Charts -->
<div class="two-col">
    <div class="chart-container">
        <div class="chart-header">Calls Done by Agent</div>
        <div id="calls-done-chart"></div>
    </div>

    <div class="chart-container">
        <div class="chart-header">Purchase Rate by Agent</div>
        <div id="purchase-rate-chart"></div>
    </div>
</div>

<div class="chart-container">
    <div class="chart-header">High Rating % vs Purchase Rate Comparison</div>
    <div id="comparison-chart"></div>
</div>

<script>
// Calls Done Chart
var callsDoneOptions = {
    series: [{
        name: 'Calls Done',
        data: [{% for a in agents %}{{ a.calls_done }}{% if not loop.last %}, {% endif %}{% endfor %}]
    }],
    chart: { type: 'bar', height: 350 },
    plotOptions: {
        bar: { borderRadius: 6, horizontal: false, columnWidth: '60%' }
    },
    colors: ['#6366f1'],
    dataLabels: {
        enabled: true,
        style: { fontSize: '11px' }
    },
    xaxis: {
        categories: [{% for a in agents %}'{{ a.agent }}'{% if not loop.last %}, {% endif %}{% endfor %}],
        labels: { rotate: -45, style: { fontSize: '11px' } }
    }
};
new ApexCharts(document.getElementById('calls-done-chart'), callsDoneOptions).render();

// Purchase Rate Chart
var purchaseRateOptions = {
    series: [{
        name: 'Purchase Rate',
        data: [{% for a in agents %}{{ a.purchase_rate }}{% if not loop.last %}, {% endif %}{% endfor %}]
    }],
    chart: { type: 'bar', height: 350 },
    plotOptions: {
        bar: { borderRadius: 6, horizontal: false, columnWidth: '60%' }
    },
    colors: ['#10b981'],
    dataLabels: {
        enabled: true,
        formatter: function(val) { return val + '%'; },
        style: { fontSize: '11px' }
    },
    xaxis: {
        categories: [{% for a in agents %}'{{ a.agent }}'{% if not loop.last %}, {% endif %}{% endfor %}],
        labels: { rotate: -45, style: { fontSize: '11px' } }
    },
    yaxis: { labels: { formatter: function(val) { return val + '%'; } } }
};
new ApexCharts(document.getElementById('purchase-rate-chart'), purchaseRateOptions).render();

// Comparison Chart
var comparisonOptions = {
    series: [
        {
            name: 'High Rating %',
            data: [{% for a in agents %}{{ a.high_rating }}{% if not loop.last %}, {% endif %}{% endfor %}]
        },
        {
            name: 'Purchase Rate',
            data: [{% for a in agents %}{{ a.purchase_rate }}{% if not loop.last %}, {% endif %}{% endfor %}]
        }
    ],
    chart: { type: 'bar', height: 350 },
    plotOptions: {
        bar: { horizontal: false, columnWidth: '55%', borderRadius: 6 }
    },
    colors: ['#f97316', '#10b981'],
    dataLabels: {
        enabled: true,
        formatter: function(val) { return val + '%'; },
        style: { fontSize: '10px' }
    },
    xaxis: {
        categories: [{% for a in agents %}'{{ a.agent }}'{% if not loop.last %}, {% endif %}{% endfor %}],
        labels: { rotate: -45, style: { fontSize: '11px' } }
    },
    yaxis: { labels: { formatter: function(val) { return val + '%'; } } },
    legend: { position: 'top' }
};
new ApexCharts(document.getElementById('comparison-chart'), comparisonOptions).render();
</script>
{% else %}
<div class="empty-state">
    <div class="empty-state-icon">&#128176;</div>
    <h3>No Data Available</h3>
    <p>No agent sales data found for the selected date range.</p>
</div>
{% endif %}
